# 多周期MIPS-Lite1

---
### 这里给出了所有cpu底层模块的定义

1. PC模块



- 模块接口

|信号名|方向|描述|
| - | - | - |
|[31:0]npc|I|nextPC计算单元|
|pcwr|I|PC写使能信号|
|clk|I|时钟信号|
|rst|I|复位信号|
|[31:0]pc|O|输出下一条指令地址|

- 功能定义

| 序号 | 功能名称      | 功能描述                     |
| ---- | ------------- | ---------------------------- |
| 1    | 复位          | if rst=1，pc<-0x00003000     |
| 2    | 保存npc并输出 | clk上升沿，if rst=0，pc<-npc |





2. NPC模块

- 模块接口

|信号名|方向|描述|
| - | - | - |
|[31:0]pc|I|本条指令的地址|
|[15:0]imm16|I|16位立即数|
|[25:0]imm26|I|26位立即数|
|[1:0]npcop|I|计算方式|
|[31:0]npc|O|下条指令的地址|
- 功能定义

| npcop | 功能名称            | 功能描述                  |
| ----- | ------------------- | ------------------------- |
| 00    | 顺序地址            | npc<-pc+1                 |
| 01    | 计算B类指令转移地址 | npc<-pc+{sign_ext(imm16)} |
| 10    | 计算J类指令转移地址 | npc<-{pc[31:28],imm26}    |



3. DM模块

- 模块接口

|信号名|方向|描述|
| - | - | - |
|clk|I|时钟信号|
|dmwr|I|读写控制信号，高电平写低电平读|
|[11:2]address|I|访问地址|
|[31:0]din|I|需要写回的数据|
|[31:0]dout|O|读出的数据|
- 功能定义

| 序号 | 功能名称 | 功能描述                                 |
| ---- | -------- | ---------------------------------------- |
| 1    | 读储存   | clk上升沿时，<br /> 输出地址所对应的数据 |
| 2    | 写储存   | 当写使能有效时，将待写数据写入对应地址   |





4. IMnoc模块

- 模块接口

|信号名|方向|描述|
| - | - | - |
|dwmr|I|读控制信号|
|[11:2]address|I|访问地址|
|[31:0]dout|O|读出的指令|
- 功能定义

| 序号 | 功能名称     | 功能描述             |
| ---- | ------------ | -------------------- |
| 1    | 读指令存储器 | 输出地址所对应的指令 |





5. EXT模块

- 模块接口

| 信号名      | 方向 | 描述                                                         |
| ----------- | ---- | ------------------------------------------------------------ |
| [15:0]Imm16 | I    | 需要进行拓展的数据                                           |
| [1:0]extop  | I    | 拓展方式的控制信号<br /> 00:0拓展，01:符号拓展，10:将立即数拓展到高位 |
| [31:0]Imm32 | O    | 拓展结果                                                     |

- 功能定义

| extop | 功能名称   | 功能描述                       |
| ----- | ---------- | ------------------------------ |
| 00    | 无符号拓展 | imm32<-{16'b0,imm16}           |
| 01    | 符号拓展   | imm32<-{{16{imm16[15]}},imm16} |
| 10    | 高位拓展   | imm32<-{imm16,16'b0}           |



6. ALU模块

- 模块接口

|信号名|方向|描述|
| - | - | - |
|[31:0]A|I|操作数A|
|[31:0]B|I|操作数B|
|[3:0]aluop|I|运算操作数|
|zero|O|两操作数是否相等|
|[31:0]C|O|运算结果|
- 功能定义

| aloud | 功能名称     | 功能描述      |
| ----- | ------------ | ------------- |
| 0000  | 直接赋值     | C <- A        |
| 0101  | 加           | C <- A + B    |
| 0110  | 减           | C <- A - B    |
| 0001  | 与           | C <- A & B    |
| 0010  | 或           | C <- A \| B   |
| 0100  | 异或         | C <- A ^ B    |
| 0011  | 取反         | C <- not A    |
| 0111  | 加一         | C <- A + 1    |
| 1000  | 减一         | C <- A - 1    |
| 1001  | 输出清零     | C <- 0        |
| 1010  | 或非（拓展） | Zero(A<B)?1:0 |





7. IR模块

- 模块接口

|信号名|方向|描述|
| - | - | - |
|[31:0]im_din|I|指令输入|
|irwr|I|写使能信号|
|rst|I|复位信号|
|clk|I|时钟信号|
|[31:0]im_dout|O|指令输出|
- 功能定义

| 序号 | 功能名称 | 功能描述                  |
| ---- | -------- | ------------------------- |
| 1    | 复位     | if rst=1，im_dout<-0      |
| 2    | 缓冲     | if rst=0，im_dout<-im_din |





8. MUX模块

- 模块接口

|信号名|方向|描述|
| - | - | - |
|d0,d1,,,|I|供选择数据|
|s|I|片选信号|
|y|O|片选后的数据|





9. RF模块

- 模块接口

|信号名|方向|描述|
| - | - | - |
|[4:0]Reg1|I|寄存器rs的地址|
|[4:0]Reg2|I|寄存器rt的地址|
|[4:0]WriteReg|I|寄存器地址的输入端(rd中的地址)|
|clk|I|时钟信号|
|RegWre|I|寄存器是否需要写功能|
|[31:0]WriteData|I|寄存器数据输入端|
|[31:0]DataOut1|O|rs寄存器数据输出端|
|[31:0]DataOut2|O|rt寄存器数据输出端|



- 功能定义

| 序号 | 功能名称 | 功能描述                                        |
| ---- | -------- | ----------------------------------------------- |
| 1    | 写操作   | 当‘RegWre’==1且’WriteReg‘！=0时写入地址         |
| 2    | 读操作   | 将rs rt地址所对应的数据从DataOut1和DataOut2输出 |



10. DL模块

- 模块接口

| 信号名     | 方向 | 描述     |
| ---------- | ---- | -------- |
| [31:0]din  | I    | 数据输入 |
| rst        | I    | 复位信号 |
| clk        | I    | 时钟信号 |
| [31:0]dout | O    | 数据输出 |



- 功能定义

| 序号 | 功能名称 | 功能描述                                 |
| ---- | -------- | ---------------------------------------- |
| 1    | 数据缓冲 | 用于数据延迟，目的是使得数据正常输入输出 |



11. ContralUnit模块

- 模块接口

| 信号名     | 方向 | 描述                                                    |
| ---------- | ---- | ------------------------------------------------------- |
| clk        | I    | 时钟信号                                                |
| rst        | I    | 复位信号                                                |
| [5:0]op    | I    | 指令中opcode域                                          |
| [5:0]funct | I    | 指令中funct域                                           |
| zero       | I    | ALU输出信号<br />0:ALU两操作数不相等，1:ALU两操作数相等 |

- 信号说明

| 控制信号 |   状态“0”    |              状态“1”              |
| :------: | :----------: | :-------------------------------: |
|  B_sel   | rt域对应数据 | 16位立即数通过ext模块扩张后的数据 |
|   RFWr   |   RF不可写   |              RF可写               |
|   DMWr   |   DM不可写   |              DM可写               |
|   PCWr   |   PC不可写   |              PC可写               |
|   IRWr   |   IR不可写   |              IR可写               |

|    控制信号    | 作用                 |
| :------------: | -------------------- |
| [1:0]RFin_sel  | RF写入数据的片选信号 |
|   [1:0]npcop   | NPC的模式选择信号    |
|   [1:0]extop   | EXT的模式选择信号    |
|   [3:0]aluop   | ALU的模式选择信号    |
| [1:0]RFout_sel | RF写回数据的片选信号 |



- 功能定义

Contral主要功能是通过使用状态机，根据指令产生数据通路各模块在对应状态中的控制信号。



12. DP模块

- 模块接口



- 功能定义

Datapath模块为该cpu的数据通路部分，内部由PC、NPC、DM、IM、EXT、ALU、IR等模块以及一些多路选择器和缓冲器组成



13. MIPS模块

- 信号说明

| 信号名 | 方向 | 描述     |
| ------ | ---- | -------- |
| clk    | I    | 时钟信号 |
| rst    | I    | 复位信号 |

- 功能定义





### 这里给出了cpu顶层文件定义